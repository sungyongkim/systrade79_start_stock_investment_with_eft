# 거래비용과 슬리피지 완전정복

> 변동성 돌파 전략의 성패를 좌우하는 핵심 요소

## 목차
1. [거래비용의 정의와 구성](#1-거래비용의-정의와-구성)
   - 1.1 거래비용 구성요소
   - 1.2 비용 적용 방식
   - 1.3 실제 비용 예시
   - 1.4 흔한 오해: 거래비용 계산의 함정
2. [슬리피지의 이해](#2-슬리피지의-이해)
3. [거래비용이 수익률에 미치는 영향](#3-거래비용이-수익률에-미치는-영향)
4. [최소 필요 수익률 계산](#4-최소-필요-수익률-계산)
5. [거래 빈도와 수익률의 관계](#5-거래-빈도와-수익률의-관계)
6. [실전 전략 최적화](#6-실전-전략-최적화)
7. [핵심 교훈과 권장사항](#7-핵심-교훈과-권장사항)

---

## 1. 거래비용의 정의와 구성

### 1.1 거래비용 구성요소

거래비용은 크게 두 가지로 구성됩니다:

1. **슬리피지 (Slippage)**
   - 예상 체결가와 실제 체결가의 차이
   - 시장 충격, 호가 스프레드, 유동성 부족 등이 원인
   - 매수/매도 양방향 발생

2. **수수료 (Commission)**
   - 증권사에 지불하는 거래 수수료
   - 거래세, 농어촌특별세 등 세금 포함
   - 매수/매도 각각 부과

### 1.2 비용 적용 방식

```python
# 슬리피지 적용
매수가 = 목표가 × (1 + slippage)  # 더 비싸게 매수
매도가 = 시가 × (1 - slippage)    # 더 싸게 매도

# 수익률 계산
총수익률 = (매도가 - 매수가) / 매수가
순수익률 = 총수익률 - (수수료 × 2)  # 매수/매도 수수료
```

### 1.3 실제 비용 예시

| 구분 | 슬리피지 | 수수료 | 총 비용 |
|------|----------|--------|---------|
| 이상적 | 0.05% | 0.05% | 0.20% |
| 낮은 비용 | 0.10% | 0.10% | 0.40% |
| 중간 비용 | 0.10% | 0.15% | 0.50% |
| 높은 비용 | 0.20% | 0.30% | 1.00% |

### 1.4 흔한 오해: 거래비용 계산의 함정

**❌ 잘못된 계산 방식:**
"1천 회 거래로 1억원 수익을 냈으니, 1억원의 0.5%인 500만원이 총 거래비용이다"

**✅ 올바른 계산 방식:**
거래비용은 **수익액**이 아니라 **거래금액**에 대해 발생합니다.

**실제 예시:**
```
- 1천 회 거래, 각 거래당 평균 1억원 거래
- 총 거래금액 = 1,000억원
- 거래비용(0.5%) = 1,000억원 × 0.5% = 5억원
- 최종 수익 1억원 = 실제로는 6억원을 벌었지만 5억원이 비용으로 나간 것
```

**핵심 포인트:**
- 거래비용은 거래할 때마다 발생
- 거래 횟수가 많을수록 누적 비용이 기하급수적 증가
- 고빈도 매매가 어려운 근본적 이유
- 1천 회 거래 시 수익의 5배에 달하는 비용이 발생할 수 있음

---

## 2. 슬리피지의 이해

### 2.1 슬리피지 발생 원인

1. **시장 충격 (Market Impact)**
   - 대량 주문이 가격에 미치는 영향
   - 주문량이 클수록 슬리피지 증가

2. **호가 스프레드 (Bid-Ask Spread)**
   - 매수호가와 매도호가의 차이
   - 유동성이 낮을수록 스프레드 확대

3. **체결 지연**
   - 주문 전송부터 체결까지의 시간차
   - 변동성이 클수록 영향 증가

### 2.2 슬리피지 최소화 방법

- 유동성이 풍부한 시간대 거래
- 시장가 주문 대신 지정가 활용
- 대량 주문은 분할 체결
- 변동성이 낮은 시간대 선택

---

## 3. 거래비용이 수익률에 미치는 영향

### 3.1 단일 거래 영향

**예시: 2% 수익 기회**
```
비용 없음: 2.00% 수익
슬리피지만: 1.80% 수익 (10% 감소)
슬리피지+수수료: 1.50% 수익 (25% 감소)
```

### 3.2 연간 누적 영향

**TQQQ 실제 사례 (연 369회 거래)**
```
비용 전 수익률: 511.1%
비용 후 수익률: -3.3%
영향: -514.5%p
```

**SQQQ 실제 사례 (연 267회 거래)**
```
비용 전 수익률: 563.9%
비용 후 수익률: 75.0%
영향: -488.9%p
```

### 3.3 거래 빈도별 영향

| 연간 거래수 | 거래당 비용 | 연간 총 비용 | 필요 최소 수익률 |
|------------|-------------|--------------|------------------|
| 50회 | 0.5% | 25% | 연 25% 이상 |
| 100회 | 0.5% | 50% | 연 50% 이상 |
| 200회 | 0.5% | 100% | 연 100% 이상 |
| 300회 | 0.5% | 150% | 연 150% 이상 |

---

## 4. 최소 필요 수익률 계산

### 4.1 손익분기점

거래당 최소 필요 수익률 = 슬리피지 × 2 + 수수료 × 2

**중간 비용 기준 (0.5%)**
- 슬리피지: 0.1% × 2 = 0.2%
- 수수료: 0.15% × 2 = 0.3%
- **손익분기점: 0.5%**

### 4.2 승률별 필요 수익률

| 승률 | 평균 손실 -1% 가정 | 필요 평균 수익률 |
|------|-------------------|------------------|
| 50% | 손실 커버 필요 | 2.00% |
| 55% | 손실 커버 필요 | 1.73% |
| 60% | 손실 커버 필요 | 1.50% |
| 65% | 손실 커버 필요 | 1.31% |

### 4.3 목표 수익률 달성 조건

**연 50% 수익 목표**
- 100회 거래: 거래당 0.91% 필요
- 200회 거래: 거래당 0.70% 필요
- 300회 거래: 거래당 0.64% 필요

**연 100% 수익 목표**
- 100회 거래: 거래당 1.20% 필요
- 200회 거래: 거래당 0.85% 필요
- 300회 거래: 거래당 0.73% 필요

---

## 5. 거래 빈도와 수익률의 관계

### 5.1 이론 vs 현실

**이론적 최적**
- 수익률이 높으면 거래가 많을수록 유리
- 복리 효과로 기하급수적 증가

**현실적 문제**
1. 거래 증가 → 실수 확률 증가
2. 거래 증가 → 심리적 부담 증가
3. 거래 증가 → 슬리피지 증가
4. 거래 증가 → 시스템 리스크 증가

### 5.2 리스크 조정 성과

| 전략 | 거래수 | 수익률(비용전) | 수익률(비용후) | Sharpe Ratio |
|------|--------|----------------|----------------|--------------|
| 적은 거래 | 50회 | 110.5% | 64.5% | 4.42 |
| 중간 거래 | 100회 | 170.5% | 64.7% | 3.13 |
| 많은 거래 | 200회 | 303.5% | 49.1% | 1.67 |
| TQQQ 실제 | 369회 | 603.2% | 11.7% | 0.25 |

### 5.3 최적 거래 빈도

```
평균 수익률 0.6% → 최적 거래수 500회 (이론)
평균 수익률 1.0% → 최적 거래수 500회 (이론)
평균 수익률 1.5% → 최적 거래수 500회 (이론)

하지만 실전에서는 연 100-150회가 적정
```

---

## 6. 실전 전략 최적화

### 6.1 거래 비용을 고려한 파라미터 최적화

**비용 없을 때 vs 비용 있을 때**

| 종목 | 최적 K값 | 최적 ADX | 비용전 수익률 | 비용후 수익률 |
|------|----------|----------|---------------|---------------|
| TQQQ | 0.3 | 15 | 511.1% | -3.3% |
| SQQQ | 0.3 | 15 | 563.9% | 75.0% |

**거래 빈도 감소 전략**
1. K값 상향 조정 (0.3 → 0.5 → 0.7)
2. ADX 임계값 상향 (15 → 20 → 25)
3. 추가 필터 적용 (Chaikin, 절대모멘텀)

### 6.2 필터 강화 효과

| 설정 | TQQQ 거래수 | TQQQ 수익률(비용후) | SQQQ 거래수 | SQQQ 수익률(비용후) |
|------|-------------|---------------------|-------------|---------------------|
| K=0.3, ADX>15 | 369회 | -3.3% | 267회 | 75.0% |
| K=0.5, ADX>20 | 209회 | 15.2% | 133회 | 42.8% |
| K=0.7, ADX>25 | 148회 | 8.9% | 81회 | 22.1% |

### 6.3 코드 구현 예시

```python
def volatility_breakout_with_costs(df, k=0.5, adx_threshold=20, 
                                  slippage=0.001, commission=0.0015):
    """거래 비용을 고려한 변동성 돌파 전략"""
    
    # 매수가와 매도가 (슬리피지 적용)
    result['buy_price'] = result['target_price'] * (1 + slippage)
    result['sell_price'] = result['open'].shift(-1) * (1 - slippage)
    
    # 수익률 계산 (수수료 포함)
    if commission > 0:
        result.loc[buy_condition, 'returns'] = (
            (result.loc[buy_condition, 'sell_price'] - 
             result.loc[buy_condition, 'buy_price']) / 
            result.loc[buy_condition, 'buy_price'] - (2 * commission)
        )
```

---

## 7. 핵심 교훈과 권장사항

### 7.1 핵심 교훈

1. **거래 비용은 복리로 누적**
   - 작은 비용도 장기적으로 치명적
   - 고빈도 전략일수록 영향 극대화

2. **수익률 vs 거래 빈도 트레이드오프**
   - "많은 거래 + 낮은 수익" < "적은 거래 + 높은 수익"
   - 품질 > 수량

3. **리스크 조정 수익률이 중요**
   - 높은 수익률도 변동성 고려 필요
   - Sharpe Ratio로 평가

### 7.2 실전 권장사항

**거래당 목표 수익률**
- 최소: 0.5% (손익분기점)
- 권장: 1.0% 이상
- 이상적: 1.5% 이상

**적정 거래 빈도**
- 연간 100-150회
- 주당 2-3회
- 일일 최대 1회

**필터 강화 방안**
1. ADX > 20 이상
2. 승률 60% 이상 유지
3. 절대 모멘텀 필터 추가
4. 변동성 큰 시기 집중

### 7.3 최종 체크리스트

- [ ] 거래당 평균 수익률 1% 이상인가?
- [ ] 연간 거래 횟수 150회 이하인가?
- [ ] 승률이 60% 이상인가?
- [ ] 슬리피지를 최소화할 방법이 있는가?
- [ ] 수수료가 낮은 증권사를 사용하는가?
- [ ] 리스크 관리 계획이 있는가?

---

## 결론

거래 비용은 단타 전략의 가장 큰 적입니다. 이론적으로 완벽한 전략도 거래 비용 앞에서는 무력해질 수 있습니다. 

**성공의 열쇠는:**
1. 거래 비용을 항상 고려한 백테스팅
2. 고품질 신호만 선별하는 엄격한 필터
3. 적정 수준의 거래 빈도 유지
4. 지속적인 비용 최소화 노력

변동성 돌파 전략의 성공은 얼마나 많이 거래하느냐가 아니라, 얼마나 좋은 기회를 포착하느냐에 달려 있습니다.