# 거래비용과 슬리피지 정확한 이해

> 변동성 돌파 전략의 성패를 좌우하는 핵심 요소의 수학적으로 정확한 분석

## 목차
1. [거래비용의 정의와 구성](#1-거래비용의-정의와-구성)
2. [슬리피지의 이해](#2-슬리피지의-이해)
3. [거래비용의 복리 효과 - 정확한 계산](#3-거래비용의-복리-효과---정확한-계산)
4. [시장별 현실적인 비용 수준](#4-시장별-현실적인-비용-수준)
5. [거래비용이 수익률에 미치는 영향](#5-거래비용이-수익률에-미치는-영향)
6. [최소 필요 수익률의 정확한 계산](#6-최소-필요-수익률의-정확한-계산)
7. [실전 전략 최적화](#7-실전-전략-최적화)
8. [핵심 교훈과 권장사항](#8-핵심-교훈과-권장사항)

---

## 1. 거래비용의 정의와 구성

### 1.1 거래비용 구성요소

거래비용은 크게 두 가지로 구성됩니다:

1. **슬리피지 (Slippage)**
   - 예상 체결가와 실제 체결가의 차이
   - 시장 충격, 호가 스프레드, 유동성 부족 등이 원인
   - 매수/매도 양방향 발생

2. **수수료 (Commission)**
   - 증권사에 지불하는 거래 수수료
   - 거래세, 농어촌특별세 등 세금 포함
   - 매수/매도 각각 부과

### 1.2 비용 적용 방식

```python
# 슬리피지 적용
매수가 = 목표가 × (1 + slippage)  # 더 비싸게 매수
매도가 = 시가 × (1 - slippage)    # 더 싸게 매도

# 수익률 계산
총수익률 = (매도가 - 매수가) / 매수가
순수익률 = 총수익률 - (수수료 × 2)  # 매수/매도 수수료
```

### 1.3 현실적인 비용 예시

| 구분 | 미국 초유동 ETF | 국내 대형주 | 국내 소형주 |
|------|----------------|------------|------------|
| 스프레드/슬리피지 | 5~15bp | 10~30bp | 30~100bp |
| 수수료/세금 | 0~5bp | 10~40bp | 20~50bp |
| **라운드트립 총비용** | **10~20bp** | **20~70bp** | **50~150bp** |

*bp = basis point (0.01%)

### 1.4 흔한 오해: 거래비용 계산의 함정

**❌ 잘못된 이해:**
"1천 회 거래로 1억원 수익을 냈으니, 1억원의 0.5%인 500만원이 총 거래비용이다"

**✅ 올바른 이해:**
거래비용은 **수익액**이 아니라 **거래금액**에 대해 발생합니다.

**실제 예시:**
```
- 1천 회 거래, 각 거래당 평균 1억원 거래
- 총 거래금액 = 1,000억원
- 거래비용(0.5%) = 1,000억원 × 0.5% = 5억원
- 최종 수익 1억원 = 실제로는 6억원을 벌었지만 5억원이 비용으로 나간 것
```

---

## 2. 슬리피지의 이해

### 2.1 슬리피지 발생 원인

1. **시장 충격 (Market Impact)**
   - 대량 주문이 가격에 미치는 영향
   - 주문량이 클수록 슬리피지 증가

2. **호가 스프레드 (Bid-Ask Spread)**
   - 매수호가와 매도호가의 차이
   - 유동성이 낮을수록 스프레드 확대

3. **체결 지연**
   - 주문 전송부터 체결까지의 시간차
   - 변동성이 클수록 영향 증가

### 2.2 슬리피지 추정 공식

```
예상 슬리피지(bp) = 0.5 × 호가스프레드(bp) + k × (주문금액/일평균거래대금)^α × 일변동성(bp)
```

여기서:
- k: 시장 충격 계수 (유동성에 따라 다름)
- α: 일반적으로 0.5~0.7

---

## 3. 거래비용의 복리 효과 - 정확한 계산

### 3.1 수학적으로 정확한 복리 계산

거래비용이 c%일 때, N번 거래 후 총 비용 드래그:

**정확한 공식:**
```
총 비용 드래그 = 1 - (1 - c)^N
```

### 3.2 실제 계산 결과 (c = 0.5%인 경우)

| 거래 횟수 | 잘못된 계산 | 정확한 계산 | 차이 |
|----------|------------|------------|------|
| 50회 | 25.0% | 22.2% | -2.8%p |
| 100회 | 50.0% | 39.4% | -10.6%p |
| 200회 | 100.0% | 63.2% | -36.8%p |
| 300회 | 150.0% | 78.9% | -71.1%p |

**중요:** 단순 곱셈은 복리 효과를 과대평가합니다!

### 3.3 비용률별 복리 효과

```python
# 정확한 계산 예시
def calculate_cost_drag(cost_per_trade, num_trades):
    """거래비용의 복리 효과 계산"""
    return 1 - (1 - cost_per_trade) ** num_trades

# 예시: 0.3% 비용, 200회 거래
cost_drag = calculate_cost_drag(0.003, 200)  # 결과: 45.2%
```

---

## 4. 시장별 현실적인 비용 수준

### 4.1 미국 시장

| ETF 유동성 | 스프레드 | 수수료 | 총 라운드트립 |
|-----------|---------|--------|--------------|
| 초고유동성 (SPY, QQQ) | 1~3bp | 0~3bp | 2~6bp |
| 고유동성 (TQQQ, SQQQ) | 5~10bp | 0~5bp | 10~20bp |
| 중간 유동성 | 10~30bp | 5~10bp | 20~50bp |
| 저유동성 | 30~100bp | 10~20bp | 50~150bp |

### 4.2 한국 시장

| 종목 유형 | 매수 비용 | 매도 비용 | 총 라운드트립 |
|----------|----------|----------|--------------|
| 대형주 | 10~20bp | 20~50bp* | 30~70bp |
| 중형주 | 20~40bp | 30~60bp* | 50~100bp |
| 소형주 | 50~100bp | 60~120bp* | 110~220bp |

*매도세 0.23% 포함

### 4.3 실제 체결 로그 분석 방법

```python
def analyze_execution_cost(trades_df):
    """실제 거래 데이터로 비용 분석"""
    # 슬리피지 = (체결가 - 주문시점 중간가) / 중간가
    trades_df['slippage'] = (
        (trades_df['exec_price'] - trades_df['mid_price']) 
        / trades_df['mid_price']
    )
    
    # 시장 상황별 분석
    return trades_df.groupby(['time_of_day', 'volatility_bucket'])['slippage'].mean()
```

---

## 5. 거래비용이 수익률에 미치는 영향

### 5.1 단일 거래 영향

**예시: 2% 수익 기회**
```
총 라운드트립 비용별 실제 수익:
- 10bp (0.1%): 1.90% 수익
- 20bp (0.2%): 1.80% 수익
- 50bp (0.5%): 1.50% 수익
- 100bp (1.0%): 1.00% 수익
```

### 5.2 연간 누적 영향 - 정확한 계산

**TQQQ 실제 사례 (연 369회 거래, 라운드트립 50bp 가정)**
```python
# 정확한 복리 계산
cost_drag = 1 - (1 - 0.005) ** 369
# 결과: 84.2%

# 원래 수익률에서 차감
비용 전 수익률: 511.1%
실제 기대 수익률: 511.1% × (1 - 0.842) = 80.8%
```

### 5.3 거래 빈도와 비용의 관계

| 연간 거래수 | 10bp 비용 | 20bp 비용 | 50bp 비용 |
|-----------|-----------|-----------|-----------|
| 50회 | 4.9% | 9.5% | 22.2% |
| 100회 | 9.5% | 18.1% | 39.4% |
| 200회 | 18.1% | 33.0% | 63.2% |
| 300회 | 25.9% | 45.3% | 78.9% |

---

## 6. 최소 필요 수익률의 정확한 계산

### 6.1 손익분기점 공식

거래당 최소 필요 수익률:

```
r* = c / (1 - c)
```

여기서 c = 라운드트립 거래비용

### 6.2 비용별 손익분기점

| 라운드트립 비용 | 손익분기 수익률 | 실전 목표 (2배) |
|----------------|----------------|----------------|
| 10bp (0.1%) | 0.100% | 0.20% |
| 20bp (0.2%) | 0.201% | 0.40% |
| 50bp (0.5%) | 0.503% | 1.01% |
| 100bp (1.0%) | 1.010% | 2.02% |

### 6.3 승률을 고려한 필요 수익률

평균 손실률 L, 승률 p일 때:

```
필요 평균 수익률 = [c + (1-p)×L] / p
```

예시 (c=0.5%, L=1%, p=60%):
```
필요 수익률 = [0.5% + 0.4×1%] / 0.6 = 1.5%
```

---

## 7. 실전 전략 최적화

### 7.1 거래비용 최소화 전략

1. **시장/지정가 최적화**
   ```python
   def smart_order_type(spread, urgency, size):
       """상황별 주문 유형 결정"""
       if spread < 5bp and urgency > 0.8:
           return "market"
       elif size < daily_volume * 0.001:
           return "limit_aggressive"  # 중간가 + 1틱
       else:
           return "limit_passive"     # 중간가
   ```

2. **시간대별 거래**
   - 개장 30분 후 ~ 종장 30분 전
   - 점심시간 회피 (한국 시장)
   - 주요 경제지표 발표 시간 회피

3. **포지션 사이징**
   ```python
   position_size = min(
       capital * kelly_fraction,
       daily_volume * 0.01,  # 일 거래량의 1% 이하
       max_acceptable_loss / (atr * 2)
   )
   ```

### 7.2 필터 강화로 거래 빈도 감소

| 전략 | 거래수 | 평균 수익 | 승률 | 비용 후 수익률 |
|------|--------|----------|------|---------------|
| 기본 | 300회 | 0.5% | 55% | -15% |
| 필터 1개 | 200회 | 0.7% | 58% | 25% |
| 필터 2개 | 120회 | 1.0% | 62% | 68% |
| 필터 3개 | 80회 | 1.3% | 65% | 85% |

---

## 8. 핵심 교훈과 권장사항

### 8.1 핵심 원칙

1. **정확한 비용 측정**
   - 본인의 실제 체결 데이터로 측정
   - 시장 상황별 비용 변화 파악
   - 복리 효과를 정확히 계산

2. **현실적인 기대 수익**
   - 예상 알파가 거래비용의 3배 이상
   - 승률 60% 이상 유지
   - 거래당 1% 이상 목표

3. **체계적인 리스크 관리**
   - 포지션 크기 = f(유동성, 변동성, 자본)
   - 동적 손절/익절 설정
   - 상관관계 고려한 포트폴리오

### 8.2 실전 체크리스트

- [ ] 내 실제 평균 슬리피지는? ___bp
- [ ] 내 브로커 수수료는? ___bp
- [ ] 내 평균 거래당 수익률은? ___%
- [ ] 연간 거래 횟수는? ___회
- [ ] 복리 고려 시 연간 비용은? ___%
- [ ] 비용 대비 수익 비율은? ___배

### 8.3 최종 권장사항

**거래 빈도 목표**
- 초보자: 연 50회 이하
- 중급자: 연 100회 이하
- 고급자: 연 150회 이하

**최소 수익률 기준**
- 미국 고유동성 ETF: 거래당 0.3% 이상
- 한국 대형주: 거래당 0.7% 이상
- 한국 중소형주: 거래당 1.5% 이상

---

## 결론

거래비용의 복리 효과는 많은 투자자가 과소평가하는 가장 중요한 요소입니다. 

**성공의 핵심은:**
1. 수학적으로 정확한 비용 계산
2. 시장별 현실적인 비용 수준 파악
3. 고품질 신호로 거래 빈도 최소화
4. 지속적인 실행 품질 개선

**기억하세요**: 최고의 거래는 하지 않아도 되는 거래입니다. 정말 확실한 기회에만 집중하세요.